{% extends "base.html" %}
{load static}

{% block title %} Графики {% endblock %}

{% block styles %}
  <style>
   #chart{
        margin-top: 65px;
        margin-left: 10px;
        margin-right: 10px;
   }
   </style>

{% endblock %}

{% block content %}
{% comment %}
<div class="tabs-custom tabs-horizontal tabs-line tabs-line-big tabs-line-style-2 text-center text-md-left" id="tabs-7"> 
     <!-- Nav tabs-->
    <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item" role="presentation"><a class="nav-link active" href="#tabs-7-1" data-toggle="tab">Юридические лица (Длинные)</a></li>
        <li class="nav-item" role="presentation"><a class="nav-link" href="#tabs-7-2" data-toggle="tab">Юридические лица (Короткие)</a></li>
        <li class="nav-item" role="presentation"><a class="nav-link" href="#tabs-7-3" data-toggle="tab">Физические лица (Длинные)</a></li>
        <li class="nav-item" role="presentation"><a class="nav-link" href="#tabs-7-4" data-toggle="tab">Физические лица (Короткие)</a></li>
    </ul>

    <!-- Tab panes-->
    <div class="tab-content" id="ediv">
        <div class="tab-pane fade show active" id="tabs-7-1" role="tabpanel">
            <div id="chart-1"></div>       
        </div>

        <div class="tab-pane fade" id="tabs-7-2" role="tabpanel">
        
            <div id="chart-2" style ="width:1000px;"></div>   
            <script>
                $(document).ready(function(){
                    var w=$("#chart-1").outerWidth();
                    var ww=$("#chart-2").outerWidth();
                    alert(w);
                    alert(ww);
                    $("#chart-2").css({"width":w});
                    alert(ww);
                });
            </script>
        </div>

        <div class="tab-pane fade" id="tabs-7-3" role="tabpanel">
            <div id="chart-3" style ="width:1000px;"></div>         
        </div>

        <div class="tab-pane fade" id="tabs-7-4"role="tabpanel">
            <div id="chart-4" style ="width:1000px;"></div>        
        </div>
       
    </div> 
    </div>  
</div>{% endcomment %}

<div id="chart"></div>
<script>
    let ox = [];
    let data = {{data}};
    
    {% for line in dt %}
        ox.push('{{line}}');
    {% endfor %} 


    if (ox.length === 0){
        alert('Нет данных для построения графика за выбранный промеуток времени!');
        document.location.replace("{% url "main_url" %}");
    }
    else{
        let sh = [];
        {% for line in all_date %}
            sh.push({
                type: 'rect',
                xref: 'x',
                yref: 'paper',
                x0: '{{line}} 00:00:00',
                y0: 0,
                x1: '{{line}} 10:00:00',
                y1: 1,
                fillcolor: '#d3d3d3',
                opacity: 0.2,
                line: {width: 0}
            });
        {% endfor %} 
        {% for line in weekends %}
            sh.push({
                type: 'rect',
                xref: 'x',
                yref: 'paper',
                x0: '{{line}} 00:00:00',
                y0: 0,
                x1: '{{line}} 23:59:59',
                y1: 1,
                fillcolor: '#d3d3d3',
                opacity: 0.2,
                line: {width: 0}
            });
        {% endfor %}                    
        sh.shift();
        
        let layout = {
            title: {text:"{{title}}" + ox[0] + ' по ' + ox[ox.length - 1],},
            xaxis: {type: 'date',title: ''},
            yaxis: {title: ''},
            shapes: sh
        };

        Plotly.plot('chart',[{
            x:ox,
            y:{{data}},
            type:'line',
            line : {color: 'red'}
        }],layout);       
    } 
</script>

{% endblock %}